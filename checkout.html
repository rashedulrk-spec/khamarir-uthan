<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8">
  <title>Checkout | ржЦрж╛ржорж╛рж░рзАрж░ ржЙржарж╛ржи</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/style.css">

  <style>
    .invoice-box {
      border: 1px solid #ddd;
      padding: 20px;
      background: #fff;
    }
  </style>
</head>

<body>

<div class="container py-5">

  <h2 class="text-center mb-4">ЁЯз╛ ржЕрж░рзНржбрж╛рж░ ржлрж░ржо</h2>

  <div class="row">

    <!-- ================= LEFT : CUSTOMER FORM ================= -->
    <div class="col-md-6">

      <div class="mb-3">
        <label>ржЖржкржирж╛рж░ ржирж╛ржо</label>
        <input type="text" id="c_name" class="form-control">
      </div>

      <div class="mb-3">
        <label>ржорзЛржмрж╛ржЗрж▓ ржиржорзНржмрж░</label>
        <input type="text" id="c_phone" class="form-control">
      </div>

      <div class="mb-3">
        <label>рж╕ржорзНржкрзВрж░рзНржг ржарж┐ржХрж╛ржирж╛</label>
        <textarea id="c_address" class="form-control" rows="3"></textarea>
      </div>

      <div class="mb-3">
        <label>ржЕрж░рзНржбрж╛рж░ рж╕рж╛рж░рж╛ржВрж╢</label>
        <textarea id="orderText" class="form-control" rows="8" readonly></textarea>
      </div>

      <button class="btn btn-success w-100 mb-2" onclick="sendWhatsApp()">
        ЁЯУ▓ WhatsApp ржП ржЕрж░рзНржбрж╛рж░ ржкрж╛ржарж╛ржи
      </button>

      <button class="btn btn-primary w-100 mb-2" onclick="sendMessengerOrder()">
        ЁЯТм Messenger ржП ржЕрж░рзНржбрж╛рж░ ржкрж╛ржарж╛ржи
      </button>

      <button class="btn btn-outline-dark w-100 mb-2" onclick="manualOrder()">
        ЁЯУЮ Manual / Call Order
      </button>

      <button class="btn btn-dark w-100" onclick="window.print()">
        ЁЯЦия╕П ржЗржиржнрзЯрзЗржЬ ржкрзНрж░рж┐ржирзНржЯ
      </button>

    </div>

    <!-- ================= RIGHT : INVOICE ================= -->
    <div class="col-md-6">
      <div class="invoice-box">
        <h4 class="text-center">ржЦрж╛ржорж╛рж░рзАрж░ ржЙржарж╛ржи</h4>
        <p class="text-center">ржЦрж╛ржБржЯрж┐ рж╕рзНржмрж╛ржжрзЗрж░ ржирж┐рж╢рзНржЪрзЯрждрж╛</p>
        <hr>

        <div id="invoiceItems"></div>

        <hr>
        <h5 id="invoiceTotal"></h5>
      </div>
    </div>

  </div>
</div>

<!-- ================= JS ================= -->
<script>
const order = JSON.parse(localStorage.getItem("khamarir_order"));

if (!order) {
  alert("ржХрзЛржи ржЕрж░рзНржбрж╛рж░ ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐");
}

let text = "";
let html = "";

order.cart.forEach(item => {
  text += `${item.name} - ${item.qty} ржХрзЗржЬрж┐ = рз│${item.total}\n`;
  html += `<p>${item.name} тАФ ${item.qty} ржХрзЗржЬрж┐ ├Ч ${item.price} = рз│${item.total}</p>`;
});

text += `\nSubtotal: рз│${order.subTotal}`;
text += `\nDelivery: рз│${order.shipping}`;
text += `\nTotal: рз│${order.grandTotal}`;

document.getElementById("orderText").value = text;
document.getElementById("invoiceItems").innerHTML = html;
document.getElementById("invoiceTotal").innerText =
  "ржорзЛржЯ ржЯрж╛ржХрж╛: рз│" + order.grandTotal;
</script>

<script>
function sendToGoogleSheet(name, phone, address) {

  const params = new URLSearchParams();
  params.append("name", name);
  params.append("phone", phone);
  params.append("address", address);
  params.append("order", document.getElementById("orderText").value);
  params.append("subtotal", order.subTotal);
  params.append("delivery", order.shipping);
  params.append("total", order.grandTotal);
  params.append("source", "Website");

  return fetch(
    "https://script.google.com/macros/s/AKfycbzTmNnhAHhVlFPgPGSVpqEyu5w3Su1eyWgBXCc10g3JCd0rHEzXcma73KcU1eEKcsvfOA/exec",
    {
      method: "POST",
      body: params
    }
  );
}
</script>






<script>
function sendWhatsApp() {

  let name = c_name.value;
  let phone = c_phone.value;
  let address = c_address.value;

  if (!name || !phone || !address) {
    alert("рж╕ржм рждржерзНржп ржкрзВрж░ржг ржХрж░рзБржи");
    return;
  }

  let message =
`ржирждрзБржи ржЕрж░рзНржбрж╛рж░ (ржЦрж╛ржорж╛рж░рзАрж░ ржЙржарж╛ржи)

ржирж╛ржо: ${name}
ржорзЛржмрж╛ржЗрж▓: ${phone}
ржарж┐ржХрж╛ржирж╛: ${address}

${document.getElementById("orderText").value}`;

  sendToGoogleSheet(name, phone, address)
    .then(() => {
      window.open(
        "https://wa.me/8801842160764?text=" + encodeURIComponent(message),
        "_blank"
      );

      setTimeout(() => {
        location.href = "thankyou.html";
      }, 1200);
    })
    .catch(() => {
      alert("тЭМ ржЕрж░рзНржбрж╛рж░ ржкрж╛ржарж╛рждрзЗ рж╕ржорж╕рзНржпрж╛ рж╣рзЯрзЗржЫрзЗ");
    });
}
</script>

<script>
// ==========================
// MESSENGER ORDER
// ==========================
function sendMessengerOrder() {

  let name = document.getElementById("c_name").value;
  let phone = document.getElementById("c_phone").value;
  let address = document.getElementById("c_address").value;

  if (!name || !phone || !address) {
    alert("рж╕ржм рждржерзНржп ржкрзВрж░ржг ржХрж░рзБржи");
    return;
  }

  sendToGoogleSheet(name, phone, address);

  let message =
`ржирждрзБржи ржЕрж░рзНржбрж╛рж░ (ржЦрж╛ржорж╛рж░рзАрж░ ржЙржарж╛ржи)

ржирж╛ржо: ${name}
ржорзЛржмрж╛ржЗрж▓: ${phone}
ржарж┐ржХрж╛ржирж╛: ${address}

${document.getElementById("orderText").value}`;

  window.open(
    "https://m.me/61568617067892?ref=" + encodeURIComponent(message),
    "_blank"
  );

  setTimeout(() => {
    window.location.href = "thankyou.html";
  }, 1500);
}
</script>

<script>
// ==========================
// MANUAL ORDER
// ==========================
function manualOrder() {
  alert(
    "Manual Order\n\n" +
    "ЁЯУЮ ржХрж▓ ржХрж░рзБржи: 01842160764\n" +
    "тП░ рж╕ржХрж╛рж▓ рзпржЯрж╛ тАУ рж░рж╛ржд рззрзжржЯрж╛"
  );
}
</script>

</body>
</html>
