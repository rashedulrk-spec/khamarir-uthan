<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8">
  <title>Checkout | ‡¶ñ‡¶æ‡¶Æ‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶â‡¶†‡¶æ‡¶®</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/style.css">

  <style>
    .invoice-box {
      border: 1px solid #ddd;
      padding: 20px;
      background: #fff;
    }
  </style>
</head>

<body>

<div class="container py-5">

  <h2 class="text-center mb-4">üßæ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶´‡¶∞‡¶Æ</h2>

  <div class="row">

    <!-- ================= LEFT : CUSTOMER FORM ================= -->
    <div class="col-md-6">

      <div class="mb-3">
        <label>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
        <input type="text" id="c_name" class="form-control">
      </div>

      <div class="mb-3">
        <label>‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label>
        <input type="text" id="c_phone" class="form-control">
      </div>

      <div class="mb-3">
        <label>‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</label>
        <textarea id="c_address" class="form-control" rows="3"></textarea>
      </div>

      <div class="mb-3">
        <label>‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂</label>
        <textarea id="orderText" class="form-control" rows="8" readonly></textarea>
      </div>

      <button class="btn btn-success w-100 mb-2" onclick="sendWhatsApp()">
        üì≤ WhatsApp ‡¶è ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶™‡¶æ‡¶†‡¶æ‡¶®
      </button>

      <button class="btn btn-primary w-100 mb-2" onclick="sendMessengerOrder()">
        üí¨ Messenger ‡¶è ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶™‡¶æ‡¶†‡¶æ‡¶®
      </button>

      <button class="btn btn-outline-dark w-100 mb-2" onclick="manualOrder()">
        üìû Manual / Call Order
      </button>

      <button class="btn btn-dark w-100" onclick="window.print()">
        üñ®Ô∏è ‡¶á‡¶®‡¶≠‡ßü‡ßá‡¶ú ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü
      </button>

    </div>

    <!-- ================= RIGHT : INVOICE ================= -->
    <div class="col-md-6">
      <div class="invoice-box">
        <h4 class="text-center">‡¶ñ‡¶æ‡¶Æ‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶â‡¶†‡¶æ‡¶®</h4>
        <p class="text-center">‡¶ñ‡¶æ‡¶Å‡¶ü‡¶ø ‡¶∏‡ßç‡¶¨‡¶æ‡¶¶‡ßá‡¶∞ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡ßü‡¶§‡¶æ</p>
        <hr>

        <div id="invoiceItems"></div>

        <hr>
        <h5 id="invoiceTotal"></h5>
      </div>
    </div>

  </div>
</div>

<!-- ================= JS ================= -->
<script>
const order = JSON.parse(localStorage.getItem("khamarir_order"));

if (!order) {
  alert("‡¶ï‡ßã‡¶® ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø");
}

let text = "";
let html = "";

order.cart.forEach(item => {
  text += `${item.name} - ${item.qty} ‡¶ï‡ßá‡¶ú‡¶ø = ‡ß≥${item.total}\n`;
  html += `<p>${item.name} ‚Äî ${item.qty} ‡¶ï‡ßá‡¶ú‡¶ø √ó ${item.price} = ‡ß≥${item.total}</p>`;
});

text += `\nSubtotal: ‡ß≥${order.subTotal}`;
text += `\nDelivery: ‡ß≥${order.shipping}`;
text += `\nTotal: ‡ß≥${order.grandTotal}`;

document.getElementById("orderText").value = text;
document.getElementById("invoiceItems").innerHTML = html;
document.getElementById("invoiceTotal").innerText =
  "‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶ï‡¶æ: ‡ß≥" + order.grandTotal;
</script>

<script>
// ==========================
// GOOGLE SHEET SEND
// ==========================
function sendToGoogleSheet(name, phone, address) {

  fetch("https://script.google.com/macros/s/AKfycbyYCi9UXP0hwGvI9jSOaDVz9JnKRHZfW4SfeUObUTQPw1QKQSvRoiXG6CXWQZh7aPkEqw/exec", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
body: JSON.stringify({
  name: name,
  phone: phone,
  address: address,
  order: document.getElementById("orderText").value,
  subtotal: order.subTotal,
  delivery: order.shipping,
  total: order.grandTotal,
  source: "Website"
})

  });

}
</script>

<script>
// ==========================
// WHATSAPP ORDER
// ==========================
function sendWhatsApp() {

  let name = document.getElementById("c_name").value;
  let phone = document.getElementById("c_phone").value;
  let address = document.getElementById("c_address").value;

  if (!name || !phone || !address) {
    alert("‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®");
    return;
  }

  sendToGoogleSheet(name, phone, address);

  let message =
`üßæ ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ (‡¶ñ‡¶æ‡¶Æ‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶â‡¶†‡¶æ‡¶®)

üë§ ‡¶®‡¶æ‡¶Æ: ${name}
üìû ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤: ${phone}
üè† ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ: ${address}

üõí ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞:
${document.getElementById("orderText").value}`;

  window.open(
    "https://wa.me/8801842160764?text=" + encodeURIComponent(message),
    "_blank"
  );

  setTimeout(() => {
    window.location.href = "thankyou.html";
  }, 1000);
}
</script>

<script>
// ==========================
// MESSENGER ORDER
// ==========================
function sendMessengerOrder() {

  let name = document.getElementById("c_name").value;
  let phone = document.getElementById("c_phone").value;
  let address = document.getElementById("c_address").value;

  if (!name || !phone || !address) {
    alert("‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®");
    return;
  }

  sendToGoogleSheet(name, phone, address);

  let message =
`‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ (‡¶ñ‡¶æ‡¶Æ‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶â‡¶†‡¶æ‡¶®)

‡¶®‡¶æ‡¶Æ: ${name}
‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤: ${phone}
‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ: ${address}

${document.getElementById("orderText").value}`;

  window.open(
    "https://m.me/61568617067892?ref=" + encodeURIComponent(message),
    "_blank"
  );

  setTimeout(() => {
    window.location.href = "thankyou.html";
  }, 1500);
}
</script>

<script>
// ==========================
// MANUAL ORDER
// ==========================
function manualOrder() {
  alert(
    "Manual Order\n\n" +
    "üìû ‡¶ï‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®: 01842160764\n" +
    "‚è∞ ‡¶∏‡¶ï‡¶æ‡¶≤ ‡ßØ‡¶ü‡¶æ ‚Äì ‡¶∞‡¶æ‡¶§ ‡ßß‡ß¶‡¶ü‡¶æ"
  );
}
</script>

</body>
</html>
